package task1.tests.echo;

import java.util.ArrayList;
import java.util.List;
public class EchoServer extends Task {
    public EchoServer(Broker broker, Runnable r) {
        super(broker, r);  // Appel du constructeur de Task
    }

    public static void main(String[] args) {
        Broker broker = new BrokerImpl("ServerBroker"); // Création du Broker
        EchoServer server = new EchoServer(broker, () -> {
            try {
                // Acceptation des connexions des clients et gestion des channels
                while (true) {
                    Channel channel = broker.accept(12345);
                    byte[] buffer = new byte[256];
                    int bytesRead;
                    while ((bytesRead = channel.read(buffer, 0, buffer.length)) != -1) {
                        channel.write(buffer, 0, bytesRead); // Echo les données
                    }
                    channel.disconnect();
                }
            } catch (IOException e) {
                e.printStackTrace();
            }
        });
        server.start();  // Démarrage du thread du serveur
    }
}
