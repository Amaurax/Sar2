package task1.tests.echo;

public class EchoClient extends Task {
    private String serverName;
    private int serverPort;

    public EchoClient(Broker broker, String serverName, int serverPort) {
        super(broker);
        this.serverName = serverName;
        this.serverPort = serverPort;
    }

    @Override
    public void run() {
        try {
            Channel channel = broker.connect(serverName, serverPort);
            byte[] dataToSend = new byte[255];

            for (int i = 1; i <= 255; i++) {
                dataToSend[i - 1] = (byte) i;
            }

            channel.write(dataToSend, 0, dataToSend.length);

            byte[] receivedData = new byte[255];
            int bytesRead = channel.read(receivedData, 0, receivedData.length);

            if (bytesRead != dataToSend.length) {
                System.out.println("Erreur : le nombre d'octets reçus est incorrect.");
            }

            for (int i = 0; i < bytesRead; i++) {
                if (receivedData[i] != dataToSend[i]) {
                    System.out.println("Erreur : données incohérentes.");
                }
            }

            channel.disconnect();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

